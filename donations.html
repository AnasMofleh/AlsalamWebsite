<!DOCTYPE html>
<!-- Default lang/dir set in header.html, updated by translate.js -->
<html>
<head>
     <!-- Meta, CSS links etc. are loaded via header.html -->
     <title>Al-Salam Moské - Donationer</title> <!-- Static title, or translate server-side -->
</head>
<body>
    <!-- Header Start -->
    <div id="header-placeholder"></div>
    <!-- Header End -->

    <!-- Donations Section -->
    <div class="container mt-5 pt-5 text-center">
        <div class="donations-section wow fadeIn" data-wow-delay="0.1s">
            <h3 class="mb-4" data-translate="donations.title">Donationsalternativ</h3>
            <div class="tabs-group">
                <button class="tab-button active" id="one-time" data-translate="donations.tabOneTime">Engång</button>
                <button class="tab-button" id="monthly" data-translate="donations.tabMonthly">Månatlig</button>
                <button class="tab-button" id="yearly" data-translate="donations.tabYearly">Årlig</button>
            </div>
        </div>

        <div class="row justify-content-center">
            <!-- Card 1: Swish -->
            <div class="col-lg-4 donation-box wow fadeInUp" data-wow-delay="0.2s" id="card-one">
                <div class="row">
                    <h4>Gåva via Swish</h4>
                    <p>Stödja moskén genom att swisha engångdonation "Gåva".</p>
                </div>
                <div class="circle-border">
                    <img src="img/swishwakfQR.png" alt="Swish QR Code" class="donation-img">
                </div>
                <button class="donation-btn" onclick="openSwish()">Swisha</button>
            </div>
            <!-- Swish Popup -->
            <div id="swish-popup" class="popup" style="display: none;">
                <div class="popup-content">
                    <!-- Close Button -->
                    <button class="close-btn" onclick="hideSwishPopup()">X</button>

                    <!-- Popup Content -->
                    <h4 style="text-align: center;">Swish kräver mobil</h4>
                    <p>Swish-betalning fungerar endast på mobiltelefoner med Swish-appen installerad.</p>
                    <p>Alternativt kan du skanna QR-koden nedan:</p>
                    <img src="img/swishwakfQR.png" alt="Swish QR"
                        style="width: 100%; max-width: 200px; margin: 10px auto 10px; display: block;" />

                    <!-- Close Button -->
                    <button class="donation-btn" onclick="hideSwishPopup()">Stäng</button>
                </div>
            </div>


            <div class="col-lg-4 donation-box" id="card-two">
                <div class="row">
                    <h4>Gåva via andra betalningssätt</h4>
                    <p>Stödja moskén genom att använda andra betalnings metoder.</p>
                </div>
                <div class="circle-border">
                    <img src="img/pay.png" alt="International Donation Logo" class="donation-img">
                </div>
                 <!-- Stripe Button: Text/Language is controlled via Stripe dashboard configuration -->
                <script async src="https://js.stripe.com/v3/buy-button.js"></script>
                <stripe-buy-button buy-button-id="buy_btn_1S3NspG84lZUxh2hjMuXI9tr"
                    publishable-key="pk_live_51QOjFxG84lZUxh2hwRThSaug3j7zlPSL9Ts5OXxkOMw5KxHnvxusRgNIME8PtWpsFEGI9x2tSEvisU0269pHsNnm00kHzyvueL">
                </stripe-buy-button>
            </div>

            <!-- Card 3: Monthly (Stripe Subscription Button) -->
            <div class="col-lg-4 donation-box wow fadeInUp" data-wow-delay="0.4s" id="card-three">
                <div class="row">
                    <h4>Månatlig Gåva</h4>
                    <p>Stödja moskén via automatisk återkommande Gåva varje månad (likt Autogiro).</p>
                </div>
                <div class="circle-border">
                    <img src="img/sadaka.png" alt="Monthly Donation Icon" class="donation-img">
                </div>
                <script async src="https://js.stripe.com/v3/buy-button.js">
                </script>

                <stripe-buy-button buy-button-id="buy_btn_1S3O36G84lZUxh2hb3x1mP1b"
                    publishable-key="pk_live_51QOjFxG84lZUxh2hwRThSaug3j7zlPSL9Ts5OXxkOMw5KxHnvxusRgNIME8PtWpsFEGI9x2tSEvisU0269pHsNnm00kHzyvueL">
                </stripe-buy-button>
            </div>

            <div class="col-lg-6 donation-box" id="card-four">
                <div class="row">
                    <h4>Gåva via Skattsedel</h4>
                    <p>Stödja moskén genom att ge din moskéavgiften via skattsedel varje år.</p>
                </div>

                <!-- Replace circle-border image and button with iframe -->
                <div class="iframe-container">
                    <iframe src="https://medlem.fifs.se/SCH" width="100%" height="500"
                        style="border: 2px solid #ccc; border-radius: 10px;" title="Ansökan via FIFS">
                    </iframe>
                </div>
            </div>

        </div>
    </div>

    <!-- Footer Start -->
    <div id="footer-placeholder"></div>
    <!-- Footer End -->

    <!-- JavaScript Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script> <!-- Load main JS first -->

     <!-- Load Header and Footer & Initialize Translation -->
    <script>
        $(function () {
            // Using the same loading logic as index.html for consistency
            let headerLoaded = false;
            let footerLoaded = false;
            let initialLangApplied = false;

            function applyInitialLanguage() {
                if (headerLoaded && footerLoaded && !initialLangApplied) {
                     if (window.translatePage) {
                        const savedLang = localStorage.getItem('selectedLanguage') || 'sv';
                         if (window.translations && window.translations[savedLang]) {
                             window.translatePage(savedLang);
                             initialLangApplied = true;
                         } else { setTimeout(applyInitialLanguage, 100); }
                    } else { setTimeout(applyInitialLanguage, 100); }
                }
            }

            $("#header-placeholder").load("header.html", function(response, status, xhr) {
                if (status == "success") {
                    headerLoaded = true;
                    if (window.initializeLanguageSwitcher) window.initializeLanguageSwitcher();
                    applyInitialLanguage();
                } else { console.error("Error loading header.html:", status); }
            });

            $("#footer-placeholder").load("footer.html", function(response, status, xhr) {
                 if (status == "success") {
                    footerLoaded = true;
                    applyInitialLanguage();
                 } else { console.error("Error loading footer.html:", status); }
            });

             document.addEventListener('languageChanged', function(e) {
                 console.log("Language changed event received for:", e.detail.lang);
                 // Re-translate donation cards/popup if needed
             });
        });
    </script>

    <!-- Popup Script -->
    <script>
        function isMobileDevice() {
            return /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);
        }

        function openSwish() {
            const swishNumber = "1235000559"; // your Swish number
            const swishData = encodeURIComponent(
                JSON.stringify({
                    version: 1,
                    payee: { value: swishNumber }
                })
            );

            if (isMobileDevice()) {
                window.location.href = `swish://payment?data=${swishData}`;
            } else {
                document.getElementById("swish-popup").style.display = "flex";
            }
        }

        function hideSwishPopup() {
            document.getElementById("swish-popup").style.display = "none";
        }
    </script>

    <!-- Tab/Card Visibility Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('.tab-button');
            const cards = { // Use object for easier mapping
                'one-time': [document.querySelector('#card-one'), document.querySelector('#card-two')],
                'monthly': [document.querySelector('#card-three')],
                'yearly': [document.querySelector('#card-four')]
            };
            const allCardElements = document.querySelectorAll('.donation-box'); // Select all boxes

            function updateVisibleCards(activeTabId) {
                 allCardElements.forEach(card => {
                     if(card) card.classList.remove('visible'); // Hide all first
                 });

                if (cards[activeTabId]) {
                    cards[activeTabId].forEach(card => {
                         if(card) card.classList.add('visible'); // Show relevant cards
                    });
                }
            }

            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    buttons.forEach(btn => btn.classList.remove('active')); // Standard Bootstrap active class
                    button.classList.add('active');
                    updateVisibleCards(button.id);
                });
            });

            // Initial state: Simulate click on the default active button ("one-time")
            const initialActiveButton = document.querySelector('.tab-button.active');
             if(initialActiveButton) {
                 updateVisibleCards(initialActiveButton.id);
             } else {
                 // Fallback if no button starts active (shouldn't happen with current HTML)
                 const firstButton = document.querySelector('.tab-button');
                 if (firstButton) {
                     firstButton.classList.add('active');
                     updateVisibleCards(firstButton.id);
                 }
             }
        });
    </script>
    <!-- Translation scripts are loaded within header.html -->

</body>
</html>