<!DOCTYPE html>
<!-- Default lang/dir set in header.html, updated by translate.js -->
<html>
<head>
     <!-- Meta, CSS links etc. are loaded via header.html -->
     <title>Al-Salam Moské - Donationer</title> <!-- Static title, or translate server-side -->
</head>
<body>
    <!-- Header Start -->
    <div id="header-placeholder"></div>
    <!-- Header End -->

    <!-- Donations Section -->
    <div class="container mt-5 pt-5 text-center">
        <div class="donations-section wow fadeIn" data-wow-delay="0.1s">
            <h3 class="mb-4" data-translate="donations.title">Donationsalternativ</h3>
            <div class="tabs-group">
                <button class="tab-button active" id="one-time" data-translate="donations.tabOneTime">Engång</button>
                <button class="tab-button" id="monthly" data-translate="donations.tabMonthly">Månatlig</button>
                <button class="tab-button" id="yearly" data-translate="donations.tabYearly">Årlig</button>
            </div>
        </div>

        <div class="row justify-content-center">
            <!-- Card 1: Swish -->
            <div class="col-lg-4 donation-box wow fadeInUp" data-wow-delay="0.2s" id="card-one">
                <div class="row">
                    <h4 data-translate="donations.card1Title">Sadaqa via Swish</h4>
                    <p data-translate="donations.card1Description">Stödja moskén genom att swisha...</p>
                </div>
                <div class="circle-border">
                    <img src="img/swishwakfQR.png" alt="Swish QR Code" class="donation-img">
                </div>
                <!-- Swish button likely triggers external app or copies number. Text translation is main part. -->
                <button class="donation-btn" data-translate="donations.card1Button">Swisha</button>
            </div>

            <!-- Card 2: Other Methods (Stripe Buy Button) -->
            <div class="col-lg-4 donation-box wow fadeInUp" data-wow-delay="0.3s" id="card-two">
                <div class="row">
                    <h4 data-translate="donations.card2Title">Sadaqa via andra betalningssätt</h4>
                    <p data-translate="donations.card2Description">Stödja moskén genom att använda...</p>
                </div>
                <div class="circle-border">
                    <img src="img/pay.png" alt="International Donation Logo" class="donation-img">
                </div>
                 <!-- Stripe Button: Text/Language is controlled via Stripe dashboard configuration -->
                <script async src="https://js.stripe.com/v3/buy-button.js"></script>
                <stripe-buy-button style="object-fit: scale-down;" buy-button-id="buy_btn_1Qif7A4NRiKXf2Acps6r0nnB"
                    publishable-key="pk_test_51Qif184NRiKXf2AcFLKJf95efg4T3AdVCjOfXnjf9WusKP34BznXlDlDcvC3OV9lfAHvyQtB7YIBlFzJJbsjdC9V009OSPHbSu">
                </stripe-buy-button>
            </div>

            <!-- Card 3: Monthly (Stripe Subscription Button) -->
            <div class="col-lg-4 donation-box wow fadeInUp" data-wow-delay="0.4s" id="card-three">
                <div class="row">
                    <h4 data-translate="donations.card3Title">Månatlig Sadaqa</h4>
                    <p data-translate="donations.card3Description">Stödja moskén via automatisk...</p>
                </div>
                <div class="circle-border">
                    <img src="img/sadaka.png" alt="Monthly Donation Icon" class="donation-img">
                </div>
                 <!-- Stripe Button: Text/Language is controlled via Stripe dashboard configuration -->
                <script async src="https://js.stripe.com/v3/buy-button.js"></script>
                <stripe-buy-button buy-button-id="buy_btn_1Qo28M4NRiKXf2AcbvCLA9oM"
                    publishable-key="pk_test_51Qif184NRiKXf2AcFLKJf95efg4T3AdVCjOfXnjf9WusKP34BznXlDlDcvC3OV9lfAHvyQtB7YIBlFzJJbsjdC9V009OSPHbSu">
                </stripe-buy-button>
            </div>

            <!-- Card 4: Tax Form -->
            <div class="col-lg-4 donation-box wow fadeInUp" data-wow-delay="0.5s" id="card-four">
                <div class="row">
                    <h4 data-translate="donations.card4Title">Sadaqa via Skattsedel</h4>
                    <p data-translate="donations.card4Description">Stödja moskén genom att ge din...</p>
                </div>
                <div class="circle-border">
                    <img src="img/skattsedel.png" alt="Tax Donation Icon" class="donation-img">
                </div>
                <button class="donation-btn" onclick="showPopup()" data-translate="donations.card4Button">Fyll i blanketten</button>
            </div>

            <!-- Popup for Tax Form Info -->
            <div id="popup" class="popup">
                <div class="popup-content">
                    <!-- Close Button -->
                    <button class="close-btn" onclick="hidePopup()" aria-label="Close popup">X</button>
                    <!-- Popup Information -->
                    <h4 style="text-align: center;" data-translate="donations.popupTitle">Information om Ansökan</h4>
                    <p data-translate="donations.popupIntro">Innan du fyller i ansökan...</p>
                    <ul>
                        <li data-translate="donations.popupBullet1">Lämna referensnummer fältet tom.</li>
                        <li data-translate="donations.popupBullet2">Checka <strong>INTE</strong> av boxen...</li>
                        <li>
                            <span data-translate="donations.popupBullet3">Fyll i föreningsnamn som:</span>
                            <!-- Keep association name untranslated as it's specific -->
                            <span style="color: blue;"> Al Salam Center i Helsingborg</span>
                         </li>
                    </ul>
                    <!-- Redirect Button -->
                    <button class="donation-btn" onclick="redirectToLink()" data-translate="donations.popupContinueButton">Fortsätt till Ansökan</button>
                </div>
            </div>
        </div> <!-- End row -->
    </div> <!-- End container -->

    <!-- Footer Start -->
    <div id="footer-placeholder"></div>
    <!-- Footer End -->

    <!-- JavaScript Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script> <!-- Load main JS first -->

     <!-- Load Header and Footer & Initialize Translation -->
    <script>
        $(function () {
            // Using the same loading logic as index.html for consistency
            let headerLoaded = false;
            let footerLoaded = false;
            let initialLangApplied = false;

            function applyInitialLanguage() {
                if (headerLoaded && footerLoaded && !initialLangApplied) {
                     if (window.translatePage) {
                        const savedLang = localStorage.getItem('selectedLanguage') || 'sv';
                         if (window.translations && window.translations[savedLang]) {
                             window.translatePage(savedLang);
                             initialLangApplied = true;
                         } else { setTimeout(applyInitialLanguage, 100); }
                    } else { setTimeout(applyInitialLanguage, 100); }
                }
            }

            $("#header-placeholder").load("header.html", function(response, status, xhr) {
                if (status == "success") {
                    headerLoaded = true;
                    if (window.initializeLanguageSwitcher) window.initializeLanguageSwitcher();
                    applyInitialLanguage();
                } else { console.error("Error loading header.html:", status); }
            });

            $("#footer-placeholder").load("footer.html", function(response, status, xhr) {
                 if (status == "success") {
                    footerLoaded = true;
                    applyInitialLanguage();
                 } else { console.error("Error loading footer.html:", status); }
            });

             document.addEventListener('languageChanged', function(e) {
                 console.log("Language changed event received for:", e.detail.lang);
                 // Re-translate donation cards/popup if needed
             });
        });
    </script>

    <!-- Popup Script -->
    <script>
        function showPopup() {
            const popup = document.getElementById('popup');
            if(popup) popup.style.display = 'flex';
        }

        function hidePopup() {
             const popup = document.getElementById('popup');
            if(popup) popup.style.display = 'none';
        }

        function redirectToLink() {
            window.open('https://app.assently.com/t/633yg2', '_blank'); // Open in new tab is safer
            hidePopup(); // Close popup after clicking
        }
    </script>

    <!-- Tab/Card Visibility Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('.tab-button');
            const cards = { // Use object for easier mapping
                'one-time': [document.querySelector('#card-one'), document.querySelector('#card-two')],
                'monthly': [document.querySelector('#card-three')],
                'yearly': [document.querySelector('#card-four')]
            };
            const allCardElements = document.querySelectorAll('.donation-box'); // Select all boxes

            function updateVisibleCards(activeTabId) {
                 allCardElements.forEach(card => {
                     if(card) card.classList.remove('visible'); // Hide all first
                 });

                if (cards[activeTabId]) {
                    cards[activeTabId].forEach(card => {
                         if(card) card.classList.add('visible'); // Show relevant cards
                    });
                }
            }

            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    buttons.forEach(btn => btn.classList.remove('active')); // Standard Bootstrap active class
                    button.classList.add('active');
                    updateVisibleCards(button.id);
                });
            });

            // Initial state: Simulate click on the default active button ("one-time")
            const initialActiveButton = document.querySelector('.tab-button.active');
             if(initialActiveButton) {
                 updateVisibleCards(initialActiveButton.id);
             } else {
                 // Fallback if no button starts active (shouldn't happen with current HTML)
                 const firstButton = document.querySelector('.tab-button');
                 if (firstButton) {
                     firstButton.classList.add('active');
                     updateVisibleCards(firstButton.id);
                 }
             }
        });
    </script>
    <!-- Translation scripts are loaded within header.html -->

</body>
</html>