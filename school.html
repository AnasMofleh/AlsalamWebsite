<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Al-Salam Moské</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&family=Pacifico&display=swap"
        rel="stylesheet">

    <!-- Font Awesome & Bootstrap Icons -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- CSS -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>

<body>
    <div id="header-placeholder"></div>
    <div style="margin-top: 100px;"></div>

    <div class="container-fluid px-0">
        <div class="col-12 px-0">
            <h2 class="text-center">Registreringsformulär</h2>
            <div class="formbold-main-wrapper">
                <!-- Author: FormBold Team -->
                <!-- Learn More: https://formbold.com -->
                <div class="formbold-form-wrapper">
                    <form id="schoolsform" method="POST"
                        action="https://script.google.com/macros/s/AKfycbwWHS1yB_oEpYHk16T3OOkHetyeBcGh0RHSXk518U5_lbHee9Ne4W0djxm6HwI6t1V7Hw/exec">
                        <div class="formbold-steps">
                            <ul>
                                <li class="formbold-step-menu1 active">
                                    <span>1</span>
                                    Föräldrar information
                                </li>
                                <li class="formbold-step-menu2">
                                    <span>2</span>
                                    Barnen information
                                </li>
                                <li class="formbold-step-menu3">
                                    <span>3</span>
                                    Bekräfta
                                </li>
                            </ul>
                        </div>

                        <div class="formbold-form-step-1 active">
                            <p> Pappans information: </p>
                            <div class="formbold-input-flex">
                                <div>
                                    <label for="Pappans Namn" class="formbold-form-label"> För- och efternamn </label>
                                    <input type="text" name="Pappans Namn" placeholder="Taha Ali" id="Pappans Namn"
                                        class="formbold-form-input" required />
                                </div>
                                <div>
                                    <label for="Pappans Personnummer" class="formbold-form-label"> Personnummer </label>
                                    <input type="text" name="Pappans Personnummer" id="Pappans Personnummer"
                                        placeholder="199901019999" class="formbold-form-input" required
                                        pattern="(19|20)\d{10}"
                                        title="Personnummer måste vara 12 siffror och börja med 19 eller 20" />
                                </div>

                            </div>

                            <div class="formbold-input-flex">
                                <div>
                                    <label for="Pappans Email" class="formbold-form-label"> Mejladress </label>
                                    <input type="email" name="Pappans Email" placeholder="tahaali@gmail.com"
                                        id="Pappans Email" class="formbold-form-input" required
                                        title="Ange en giltig e-postadress" />
                                </div>
                                <div>
                                    <label for="Pappans Mobilnummer" class="formbold-form-label"> Mobilnummer </label>
                                    <input type="text" name="Pappans Mobilnummer" id="Pappans Mobilnummer"
                                        placeholder="0731234567" class="formbold-form-input" required pattern="07\d{8}"
                                        title="Mobilnummer måste vara 10 siffror som börjar med 07" />
                                </div>

                            </div>



                            <button type="button" onclick="toggleSecondParent(this)" class="formbold-add-button">
                                ➕ Lägg till Mammans information
                            </button>

                            <!-- The second parent section (initially hidden) -->
                            <div id="secondParentContainer" style="display: none; margin-top: 1rem;">
                                <p>Mammans information 2:</p>
                                <div class="formbold-input-flex">
                                    <div>
                                        <label for="Mammans Namn" class="formbold-form-label">Förnamn</label>
                                        <input type="text" name="Mammans Namn" placeholder="Amina Musa"
                                            id="Mammans Namn" class="formbold-form-input" />
                                    </div>
                                    <div>
                                        <label for="Mammans Personnummer"
                                            class="formbold-form-label">Personnummer</label>
                                        <input type="text" name="Mammans Personnummer" id="Mammans Personnummer"
                                            placeholder="199901019999" class="formbold-form-input">
                                    </div>

                                </div>

                                <div class="formbold-input-flex">
                                    <div>
                                        <label for="Mammans Email" class="formbold-form-label">Mejladress</label>
                                        <input type="email" name="Mammans Email" placeholder="aminamusa@gmail.com"
                                            id="Mammans Email" class="formbold-form-input" />
                                    </div>
                                    <div>
                                        <label for="Mammans Mobilnummer"
                                            class="formbold-form-label">Mobilnummer</label>
                                        <input type="text" name="Mammans Mobilnummer" placeholder="0701234567"
                                            id="Mammans Mobilnummer" class="formbold-form-input" />
                                    </div>

                                </div>
                            </div>

                            <div class="formbold-input-flex" style="margin-top: 1rem;">
                                <div>
                                    <label for="Adress" class="formbold-form-label"> Adress </label>
                                    <input type="text" name="Adress" id="Adress" placeholder="Södergatan 65"
                                        class="formbold-form-input" required />
                                </div>
                                <div>
                                    <label for="Postnummer" class="formbold-form-label"> Postnummer </label>
                                    <input type="text" name="Postnummer" id="Postnummer" placeholder="25219"
                                        class="formbold-form-input" required pattern="\d{5}"
                                        title="Postnummer måste vara 5 siffror" />
                                </div>
                                <div>
                                    <label for="Postort" class="formbold-form-label"> Postort </label>
                                    <input type="text" name="Postort" id="Postort" placeholder="Helsingborg"
                                        class="formbold-form-input" required />
                                </div>
                            </div>
                        </div>

















                        <div class="formbold-form-step-2">
                            <!-- Container for all children -->

                            <div id="childrenContainer">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <p style="margin: 0;">Barn 1</p>
                                </div>
                                <div class="formbold-input-flex">
                                    <div>
                                        <label for="Barnet Förnamn 1" class="formbold-form-label">Förnamn</label>
                                        <input type="text" name="Barnet Förnamn []" id="Barnet Förnamn 1"
                                            placeholder="Ahmad" class="formbold-form-input" required />
                                    </div>
                                    <div>
                                        <label for="Barnet Efternamn" class="formbold-form-label">Efternamn</label>
                                        <input type="text" name="Barnet Efternamn" id="Barnet Efternamn"
                                            placeholder="Ali" class="formbold-form-input" required />
                                    </div>
                                </div>
                                <div class="formbold-input-flex">
                                    <div style="position: relative; width: 55%;">
                                        <label for="Barnets Personnummer 1"
                                            class="formbold-form-label">Personnummer</label>
                                        <div style="display: flex; align-items: center;">
                                            <input type="text" name="Barnets Personnummer []" id="Barnets Personnummer 1" 
                                                placeholder="YYYYMMDDXXXX" class="formbold-form-input" required
                                                pattern="(19|20)?\d{10}" title="Personnummer måste vara 12 siffror" />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Add Child Button -->
                            <button type="button" onclick="addChild()" class="formbold-add-button"
                                style="margin-bottom: 1rem;">
                                ➕ Lägg till Barn
                            </button>
                        </div>







                        <div class="formbold-form-step-3">
                            <div class="formbold-form-confirm">
                                <div class="container" style="display: flex; justify-content: space-around;">


                                    <fieldset>
                                        <legend>Skoldag:</legend>
                                        <div class="form-check">
                                            <label for="skoldagLördag" class="form-check-label"><input type="radio"
                                                    class="form-check-input" name="skoldag" id="skoldagLördag"
                                                    value="Lördag" required>Lördag</label>
                                        </div>
                                        <div class="form-check">
                                            <label for="skoldagSöndag" class="form-check-label"> <input type="radio"
                                                    class="form-check-input" name="skoldag" id="skoldagSöndag"
                                                    value="Söndag">Söndag</label>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                        </div>





                        <div class="formbold-form-btn-wrapper">
                            <button class="formbold-back-btn">
                                Back
                            </button>

                            <button class="formbold-btn">
                                Next Step
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <g clip-path="url(#clip0_1675_1807)">
                                        <path
                                            d="M10.7814 7.33312L7.20541 3.75712L8.14808 2.81445L13.3334 7.99979L8.14808 13.1851L7.20541 12.2425L10.7814 8.66645H2.66675V7.33312H10.7814Z"
                                            fill="white" />
                                    </g>
                                    <defs>
                                        <clipPath id="clip0_1675_1807">
                                            <rect width="16" height="16" fill="white" />
                                        </clipPath>
                                    </defs>
                                </svg>
                            </button>
                        </div>
                        <p class="mt-2 text-muted">
                            <strong>* Din ansökan och din data hanteras i enlighet med GDPR. Dina personuppgifter
                                kommer att raderas efter 4 år.</strong>
                        </p>
                    </form>
                </div>
            </div>


        </div>
    </div>
    <div id="loadingSpinner"
        style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); z-index:1000;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Laddar...</span>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <!-- Scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>
    <script src="lib\wow\wow.min.js"></script>


    <script>
        $(function () {
            $("#header-placeholder").load("header.html");
            $("#footer-placeholder").load("footer.html");
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const steps = [...document.querySelectorAll(".formbold-form-step-1, .formbold-form-step-2, .formbold-form-step-3")];
            const menus = [...document.querySelectorAll(".formbold-step-menu1, .formbold-step-menu2, .formbold-step-menu3")];
            const form = document.getElementById("schoolsform");
            const btnNext = document.querySelector(".formbold-btn");
            const btnBack = document.querySelector(".formbold-back-btn");
            const spinner = document.getElementById("loadingSpinner");

            let currentStep = 0;

            function showStep(index) {
                steps.forEach((s, i) => s.classList.toggle("active", i === index));
                menus.forEach((m, i) => m.classList.toggle("active", i === index));
                btnBack.style.display = index > 0 ? "inline-block" : "none";
                btnNext.textContent = index === steps.length - 1 ? "Submit" : "Next Step";
                currentStep = index;
                spinner.style.display = "none";
            }

            btnNext.addEventListener("click", async (e) => {
                e.preventDefault();

                // Only validate inputs in the current step
                const stepInputs = steps[currentStep].querySelectorAll("input, select, textarea");
                for (let input of stepInputs) {
                    if (!input.checkValidity()) {
                        input.reportValidity();
                        return; // Stop if invalid
                    }
                }

                if (currentStep < steps.length - 1) {
                    showStep(currentStep + 1);
                } else {
                    // Final submit
                    spinner.style.display = "block";
                    const data = new FormData(form);

                    // Convert FormData to URLSearchParams
                    const params = new URLSearchParams();
                    for (const [key, value] of data.entries()) {
                        params.append(key, value);
                    }
                    // Convert to object
                    const obj = Object.fromEntries(params);

                    // Log as JSON
                    console.log(JSON.stringify(obj, null, 2));

                    // Fire-and-forget request to Google Apps Script
                    fetch(form.action, {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: params
                    }).catch(err => console.warn("Form submission failed:", err));

                    const email = encodeURIComponent(data.get("Pappans Email") || "");
                    const pnr = encodeURIComponent(data.get("Pappans Personnummer") || "");
                    const isLocal = window.location.hostname === "localhost";

                 window.location.href = isLocal
                          ? `https://buy.stripe.com/test_cN27vE9VAeyoc9ieUW?prefilled_email=${email}&client_reference_id=${pnr}`
                          : `https://donate.stripe.com/cNi9ATgA7doc1AT6sIfw400?prefilled_email=${email}&client_reference_id=${pnr}`;
                }
            });

            btnBack.addEventListener("click", (e) => {
                e.preventDefault();
                if (currentStep > 0) showStep(currentStep - 1);
            });

            // Toggle second parent
            window.toggleSecondParent = (btn) => {
                const container = document.getElementById("secondParentContainer");
                const visible = container.style.display === "block";
                container.style.display = visible ? "none" : "block";
                btn.textContent = visible ? "➕ Lägg till Förälder 2" : "− Ta bort Förälder";
            };

            // Add child logic
            let childCount = 1;
            window.addChild = () => {
                childCount++;
                const container = document.getElementById("childrenContainer");

                const childDiv = document.createElement("div");
                childDiv.className = "child-section mb-3";
                childDiv.innerHTML = `
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <p>Barn ${childCount}</p>
                </div>
                <div class="formbold-input-flex">
                    <div>
                        <label class="formbold-form-label">Förnamn</label>
                        <input type="text" name="Barnet Förnamn[]" class="formbold-form-input" required />
                    </div>
                    <div style="width:35%;">
                        <label class="formbold-form-label">Personnummer</label>
                        <input type="text" name="Barnets Personnummer[]" placeholder="YYYYMMDDXXXX"
                            class="formbold-form-input" required pattern="(19|20)\\d{10}" 
                            title="Personnummer måste vara 12 siffror som börjar med 19 eller 20"/>
                    </div>
                        <div style="margin-top: 33px; width:10%;">
                           <button type="button" class="remove-child-btn btn btn-outline-light" 
                                style="font-size: 22px;border-radius: 50%;">
                                ❌
                            </button>
                    </div>
                </div>
            `;

                childDiv.querySelector(".remove-child-btn").addEventListener("click", () => {
                    childDiv.remove();
                    childCount--;
                });

                container.appendChild(childDiv);
            };

            // Init
            showStep(0);
        });
    </script>

</body>

</html>