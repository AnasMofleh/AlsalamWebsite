<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Al-Salam Mosk√©</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&family=Pacifico&display=swap"
        rel="stylesheet">

    <!-- Font Awesome & Bootstrap Icons -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- CSS -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>

<body>
    <div id="header-placeholder"></div>
    <div style="margin-top: 130px;"></div>

    <div class="modal fade" id="requirementsModal" tabindex="-1" aria-labelledby="requirementsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content shadow-lg rounded-4 border-0">
                <div class="modal-header bg-light border-bottom">
                    <h5 class="modal-title fw-bold" id="requirementsModalLabel">üìò Viktigt innan du fyller i formul√§ret
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="St√§ng"></button>
                </div>

                <!-- term and condition -->
                <div class="modal-body" style="max-height: 70vh; overflow-y: auto; background-color: #fff;">
                    <div class="formbold-terms px-2">
                        <h4 class="text-primary fw-bold mb-3">Skolans villkor</h4>
                        <ol class="list-decimal ps-3 pe-2 lh-lg" style="color:#333; font-size: 1rem;">

                            <li class="mb-3">
                                Kursen b√∂rjar <strong>i b√∂rjan av september</strong> och p√•g√•r till <strong>mitten av
                                    juni</strong>.
                                D√§refter erbjuds sommarkurser f√∂r de elever som vill forts√§tta.
                            </li>

                            <li class="mb-3">
                                Undervisningen sker en g√•ng i veckan v√•rdnadshavarna v√§ljer antingen
                                l√∂rdag <strong> eller </strong> s√∂ndag.<br>
                                ‚Ä¢ P√• <strong>l√∂rdagar</strong> b√∂rjar undervisningen kl.
                                <span style="color:#0d6efd; font-weight:bold;">10:00</span>.<br>
                                ‚Ä¢ P√• <strong>s√∂ndagar</strong> b√∂rjar undervisningen kl.
                                <span style="color:#0d6efd; font-weight:bold;">11:00</span>.
                            </li>

                            <li class="mb-3">
                                Undervisningen √§r cirka tv√• och halvt timmar l√•ng och best√•r av:<br>
                                ‚Ä¢ F√∂rsta timmen: <strong>arabiska spr√•ket</strong>.<br>
                                ‚Ä¢ En kvarts rast: Under rasten kan eleven √§ta en l√§tt m√•ltid.<br>
                                ‚Ä¢ Andra timmen: <strong>koranl√§sning</strong>.<br>

                            </li>

                            <li class="mb-3">
                                En av f√∂r√§ldrarna m√•ste vara medlem i Alsalam mosken genom trosamfundet
                                <a href="https://medlem.fifs.se/SCH" target="_blank"
                                    class="text-decoration-none fw-bold" style="color: #007bff;">FIFS.</a>
                                <span
                                    title="Mer information om medlemskap och betalning visas n√§r ni fyller i ans√∂kan eller genom att klicka p√• order FIFS"
                                    style="cursor: help; color: #5d06fd; font-weight: bold;">&#9432;</span>
                            </li>

                            <li class="mb-3">
                                Kursavgiften √§r <strong>160</strong> kr per m√•nad f√∂r varje elev och betalas
                                via <strong>autogiro</strong> till mosk√©skolans konto. Avgiften betalas f√∂r
                                <strong>12</strong> m√•nader.
                            </li>

                            <li class="mb-3">
                                B√∂cker och skolmaterial delas ut efter att elevens niv√• har
                                fastst√§llts. Kostnaden √§r <strong>350 kr</strong> och betalas en g√•ng.
                            </li>

                            <li class="mb-3">
                                <strong>Kommunikation:</strong> N√§r elevernas niv√•er har fastst√§llts skapas
                                <strong>WhatsApp</strong> grupper f√∂r varje klass. D√§r kan l√§rarna l√§gger upp l√§xor,
                                uppgifter och
                                viktig information f√∂r att f√∂lja upp eleverna tillsammans med f√∂r√§ldrarna.
                            </li>

                            <li class="mb-3">
                                Eleverna ska <strong>n√§rvara regelbundet</strong> och inte vara fr√•nvarande utan giltig
                                anledning.
                                Vid n√∂dv√§ndig fr√•nvaro ska detta <strong>meddelas i f√∂rv√§g</strong>.
                                L√§xor och uppgifter ska g√∂ras och f√∂ljas upp av v√•rdnadshavarna hemma.
                            </li>

                            <li class="mb-3">
                                Eleverna ska b√§ra kl√§der som √§r anpassade f√∂r mosk√©n, b√∂n och
                                v√§derf√∂rh√•llanden.
                            </li>

                            <li class="mb-3">
                                <strong>√ñmsesidig respekt</strong> ska r√•da i alla avseenden ‚Äì inga f√∂rol√§mpningar,
                                inget v√•ld och ingen farlig lek.
                                Renlighet och ordning, b√•de personlig och allm√§n, ska uppr√§tth√•llas i mosk√©n och p√•
                                v√§gen dit.
                            </li>

                            <li class="mb-3">
                                Eleverna b√∂r inte ta med v√§rdesaker. Om det √§nd√• sker, √§r det p√• <strong>egen
                                    risk</strong>.
                                Skolan ansvarar inte f√∂r borttappade eller f√∂rst√∂rda f√∂rem√•l.
                            </li>
                        </ol>
                    </div>
                </div>

                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Jag f√∂rst√•r</button>
                </div>
            </div>
        </div>
    </div>


    <div class="container-fluid px-0">
        <div class="col-12 px-0">
            <h2 class="text-center">Registreringsformul√§r</h2>
            <div class="formbold-main-wrapper">
                <!-- Author: FormBold Team -->
                <!-- Learn More: https://formbold.com -->
                <div class="formbold-form-wrapper">
                    <form id="schoolsform" method="POST"
                        action="https://script.google.com/macros/s/AKfycbwWHS1yB_oEpYHk16T3OOkHetyeBcGh0RHSXk518U5_lbHee9Ne4W0djxm6HwI6t1V7Hw/exec">
                        <div class="formbold-steps">
                            <ul>
                                <li class="formbold-step-menu1 active">
                                    <span>1</span>
                                    F√∂r√§ldrar information
                                </li>
                                <li class="formbold-step-menu2">
                                    <span>2</span>
                                    Barnen information
                                </li>
                                <li class="formbold-step-menu3">
                                    <span>3</span>
                                    Bekr√§fta
                                </li>
                            </ul>
                        </div>

                        <div class="formbold-form-step-1 active">
                            <p> Pappans information: </p>
                            <div class="formbold-input-flex">
                                <div>
                                    <label for="Pappans Namn" class="formbold-form-label"> F√∂r- och efternamn </label>
                                    <input type="text" name="Pappans Namn" placeholder="Taha Ali" id="Pappans Namn"
                                        class="formbold-form-input" required />
                                </div>
                                <div>
                                    <label for="Pappans Personnummer" class="formbold-form-label"> Personnummer </label>
                                    <input type="text" name="Pappans Personnummer" id="Pappans Personnummer"
                                        placeholder="199901019999" class="formbold-form-input" required
                                        pattern="(19|20)\d{10}"
                                        title="Personnummer m√•ste vara 12 siffror och b√∂rja med 19 eller 20" />
                                </div>

                            </div>

                            <div class="formbold-input-flex">
                                <div>
                                    <label for="Pappans Email" class="formbold-form-label"> Mejladress </label>
                                    <input type="email" name="Pappans Email" placeholder="tahaali@gmail.com"
                                        id="Pappans Email" class="formbold-form-input" required
                                        title="Ange en giltig e-postadress" />
                                </div>
                                <div>
                                    <label for="Pappans Mobilnummer" class="formbold-form-label"> Mobilnummer </label>
                                    <input type="text" name="Pappans Mobilnummer" id="Pappans Mobilnummer"
                                        placeholder="0731234567" class="formbold-form-input" required pattern="07\d{8}"
                                        title="Mobilnummer m√•ste vara 10 siffror som b√∂rjar med 07" />
                                </div>

                            </div>



                            <button type="button" onclick="toggleSecondParent(this)" class="formbold-add-button">
                                ‚ûï L√§gg till Mammans information
                            </button>

                            <!-- The second parent section (initially hidden) -->
                            <div id="secondParentContainer" style="display: none; margin-top: 1rem;">
                                <p>Mammans information 2:</p>
                                <div class="formbold-input-flex">
                                    <div>
                                        <label for="Mammans Namn" class="formbold-form-label">F√∂rnamn</label>
                                        <input type="text" name="Mammans Namn" placeholder="Amina Musa"
                                            id="Mammans Namn" class="formbold-form-input" />
                                    </div>
                                    <div>
                                        <label for="Mammans Personnummer"
                                            class="formbold-form-label">Personnummer</label>
                                        <input type="text" name="Mammans Personnummer" id="Mammans Personnummer"
                                            placeholder="199901019999" class="formbold-form-input">
                                    </div>

                                </div>

                                <div class="formbold-input-flex">
                                    <div>
                                        <label for="Mammans Email" class="formbold-form-label">Mejladress</label>
                                        <input type="email" name="Mammans Email" placeholder="aminamusa@gmail.com"
                                            id="Mammans Email" class="formbold-form-input" />
                                    </div>
                                    <div>
                                        <label for="Mammans Mobilnummer" class="formbold-form-label">Mobilnummer</label>
                                        <input type="text" name="Mammans Mobilnummer" placeholder="0701234567"
                                            id="Mammans Mobilnummer" class="formbold-form-input" />
                                    </div>

                                </div>
                            </div>

                            <div class="formbold-input-flex" style="margin-top: 1rem;">
                                <div>
                                    <label for="Adress" class="formbold-form-label"> Adress </label>
                                    <input type="text" name="Adress" id="Adress" placeholder="S√∂dergatan 65"
                                        class="formbold-form-input" required />
                                </div>
                                <div>
                                    <label for="Postnummer" class="formbold-form-label"> Postnummer </label>
                                    <input type="text" name="Postnummer" id="Postnummer" placeholder="25219"
                                        class="formbold-form-input" required pattern="\d{5}"
                                        title="Postnummer m√•ste vara 5 siffror" />
                                </div>
                                <div>
                                    <label for="Postort" class="formbold-form-label"> Postort </label>
                                    <input type="text" name="Postort" id="Postort" placeholder="Helsingborg"
                                        class="formbold-form-input" required />
                                </div>
                            </div>
                        </div>

















                        <div class="formbold-form-step-2">
                            <!-- Container for all children -->

                            <div id="childrenContainer">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <p style="margin: 0;">Barn 1</p>
                                </div>
                                <div class="formbold-input-flex">
                                    <div>
                                        <label for="Barnet F√∂rnamn 1" class="formbold-form-label">F√∂rnamn</label>
                                        <input type="text" name="Barnet F√∂rnamn" id="Barnet F√∂rnamn 1"
                                            placeholder="Ahmad" class="formbold-form-input" required />
                                    </div>
                                    <div>
                                        <label for="Barnet Efternamn" class="formbold-form-label">Efternamn</label>
                                        <input type="text" name="Barnet Efternamn" id="Barnet Efternamn"
                                            placeholder="Ali" class="formbold-form-input" required />
                                    </div>
                                </div>
                                <div class="formbold-input-flex">
                                    <div style="position: relative; width: 55%;">
                                        <label for="Barnets Personnummer 1"
                                            class="formbold-form-label">Personnummer</label>
                                        <div style="display: flex; align-items: center;">
                                            <input type="text" name="Barnets Personnummer" id="Barnets Personnummer 1"
                                                placeholder="YYYYMMDDXXXX" class="formbold-form-input" required
                                                pattern="(19|20)?\d{10}" title="Personnummer m√•ste vara 12 siffror" />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Add Child Button -->
                            <button type="button" onclick="addChild()" class="formbold-add-button"
                                style="margin-bottom: 1rem;">
                                ‚ûï L√§gg till Barn
                            </button>
                        </div>







                        <div class="formbold-form-step-3">
                            <div class="formbold-form-confirm">
                                <div class="container" style="display: flex; justify-content: space-around;">


                                    <fieldset>
                                        <legend>Skoldag:</legend>
                                        <div class="form-check">
                                            <label for="skoldagL√∂rdag" class="form-check-label"><input type="radio"
                                                    class="form-check-input" name="skoldag" id="skoldagL√∂rdag"
                                                    value="L√∂rdag" required>L√∂rdag</label>
                                        </div>
                                        <div class="form-check">
                                            <label for="skoldagS√∂ndag" class="form-check-label"> <input type="radio"
                                                    class="form-check-input" name="skoldag" id="skoldagS√∂ndag"
                                                    value="S√∂ndag">S√∂ndag</label>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                        </div>





                        <div class="formbold-form-btn-wrapper">
                            <button class="formbold-back-btn">
                                Back
                            </button>

                            <button class="formbold-btn">
                                Next Step
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <g clip-path="url(#clip0_1675_1807)">
                                        <path
                                            d="M10.7814 7.33312L7.20541 3.75712L8.14808 2.81445L13.3334 7.99979L8.14808 13.1851L7.20541 12.2425L10.7814 8.66645H2.66675V7.33312H10.7814Z"
                                            fill="white" />
                                    </g>
                                    <defs>
                                        <clipPath id="clip0_1675_1807">
                                            <rect width="16" height="16" fill="white" />
                                        </clipPath>
                                    </defs>
                                </svg>
                            </button>
                        </div>
                        <p class="mt-2 text-muted">
                            <strong>* Din ans√∂kan och din data hanteras i enlighet med GDPR. Dina personuppgifter
                                kommer att raderas efter 4 √•r.</strong>
                        </p>
                    </form>
                </div>
            </div>


        </div>
    </div>
    <div id="loadingSpinner"
        style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); z-index:1000;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Laddar...</span>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <!-- Scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>
    <script src="lib\wow\wow.min.js"></script>


    <script>
        $(function () {
            $("#header-placeholder").load("header.html");
            $("#footer-placeholder").load("footer.html");
        });
    </script>
    <script>
        $(document).ready(function () {
            const modal = new bootstrap.Modal(document.getElementById('requirementsModal'), {
                backdrop: 'static',
                keyboard: false
            });
            modal.show();
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const steps = [...document.querySelectorAll(".formbold-form-step-1, .formbold-form-step-2, .formbold-form-step-3")];
            const menus = [...document.querySelectorAll(".formbold-step-menu1, .formbold-step-menu2, .formbold-step-menu3")];
            const form = document.getElementById("schoolsform");
            const btnNext = document.querySelector(".formbold-btn");
            const btnBack = document.querySelector(".formbold-back-btn");
            const spinner = document.getElementById("loadingSpinner");

            let currentStep = 0;

            function showStep(index) {
                steps.forEach((s, i) => s.classList.toggle("active", i === index));
                menus.forEach((m, i) => m.classList.toggle("active", i === index));
                btnBack.style.display = index > 0 ? "inline-block" : "none";
                btnNext.textContent = index === steps.length - 1 ? "Submit" : "Next Step";
                currentStep = index;
                spinner.style.display = "none";
            }

            btnNext.addEventListener("click", async (e) => {
                e.preventDefault();

                // Only validate inputs in the current step
                const stepInputs = steps[currentStep].querySelectorAll("input, select, textarea");
                for (let input of stepInputs) {
                    if (!input.checkValidity()) {
                        input.reportValidity();
                        return; // Stop if invalid
                    }
                }

                if (currentStep < steps.length - 1) {
                    showStep(currentStep + 1);
                } else {
                    // Final submit
                    spinner.style.display = "block";
                    const data = new FormData(form);

                    // ‚úÖ Log all fields properly, including arrays
                    //  const debug = {};
                    //  for (const [key, value] of data.entries()) {
                    //       if (debug[key]) {
                    //            if (!Array.isArray(debug[key])) debug[key] = [debug[key]];
                    //           debug[key].push(value);
                    //      } else {
                    //           debug[key] = value;
                    //       }
                    //   }
                    //   console.log("Submitting data:", JSON.stringify(debug, null, 2));

                    try {
                        const res = await fetch(form.action, {
                            method: "POST",
                            body: data // ‚úÖ sends as multipart/form-data, works perfectly with Google Apps Script
                        });

                        const json = await res.json();
                        console.log("Response from script:", json);
                    } catch (err) {
                        console.error("Error submitting form data:", err);
                    }

                    const email = encodeURIComponent(data.get("Pappans Email") || "");
                    const pnr = encodeURIComponent(data.get("Pappans Personnummer") || "");
                    const isLocal = window.location.hostname === "localhost";

                    window.location.href = isLocal
                        ? `https://buy.stripe.com/test_cN27vE9VAeyoc9ieUW?prefilled_email=${email}&client_reference_id=${pnr}`
                        : `https://donate.stripe.com/cNi9ATgA7doc1AT6sIfw400?prefilled_email=${email}&client_reference_id=${pnr}`;
                }
            });

            btnBack.addEventListener("click", (e) => {
                e.preventDefault();
                if (currentStep > 0) showStep(currentStep - 1);
            });

            // Toggle second parent
            window.toggleSecondParent = (btn) => {
                const container = document.getElementById("secondParentContainer");
                const visible = container.style.display === "block";
                container.style.display = visible ? "none" : "block";
                btn.textContent = visible ? "‚ûï L√§gg till F√∂r√§lder 2" : "‚àí Ta bort F√∂r√§lder";
            };

            // Add child logic
            let childCount = 1;
            window.addChild = () => {
                childCount++;
                const container = document.getElementById("childrenContainer");

                const childDiv = document.createElement("div");
                childDiv.className = "child-section mb-3";
                childDiv.innerHTML = `
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <p>Barn ${childCount}</p>
                </div>
                <div class="formbold-input-flex">
                    <div>
                        <label class="formbold-form-label">F√∂rnamn</label>
                        <input type="text" name="Barnet F√∂rnamn" class="formbold-form-input" required />
                    </div>
                    <div style="width:35%;">
                        <label class="formbold-form-label">Personnummer</label>
                        <input type="text" name="Barnets Personnummer" placeholder="YYYYMMDDXXXX"
                            class="formbold-form-input" required pattern="(19|20)\\d{10}" 
                            title="Personnummer m√•ste vara 12 siffror som b√∂rjar med 19 eller 20"/>
                    </div>
                        <div style="margin-top: 33px; width:10%;">
                           <button type="button" class="remove-child-btn btn btn-outline-light" 
                                style="font-size: 22px;border-radius: 50%;">
                                ‚ùå
                            </button>
                    </div>
                </div>
            `;

                childDiv.querySelector(".remove-child-btn").addEventListener("click", () => {
                    childDiv.remove();
                    childCount--;
                });

                container.appendChild(childDiv);
            };

            // Init
            showStep(0);
        });
    </script>

    <!-- i18n module (exposed as global `loadLanguage`) -->
    <script type="module" src="i18n/js/i18n.js" defer></script>
</body>

</html>